<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="style.css" type="text/css" media="screen" />

    <title>Установка wpbb3</title>

</head>
<body>
    <div id="content">
         <h1>Интеграция wordpress и phpbb3 с помощью плагина wpbb3</h1>

         <h2>1. Подготовка</h2>

         <p>1.1 Делаем бэкап базы. Делаем сразу, чтобы не забыть сделать потом.</p>
         <p>1.2 Распаковываем архив с плагином в папку <strong>/wp-content/plugins/wpbb3</strong>.</p>
         <p>1.3 Качаем форум phpbb3 <a href="http://www.phpbb.com/downloads/">отсюда</a> и распаковывываем его
             в папку <strong>wp-content/plugins/wpbb3/forum</strong>. По желанию качаем и ставим нужный языковой
             пакет для форума.
         </p>
         <p>
            1.4 Устанавливаем форум, для этого заходим по адресу <strong>http://%domenname%/wp-content/plugins/wpbb3/forum/</strong>
            и следуем инструкции. Если нам предлагают сконвертировать базу - отказываемся. <strong>Внимание!</strong>
             Запоминаем <strong>имя</strong> и <strong>пароль</strong> администратора форума.
        </p>
        <p>
            После установки не забываем переименовать или удалить папку <strong>install</strong>.
        </p>
        <p>
            1.5 Копируем из папки <strong>/wp-content/plugins/wpbb3/phpbb3</strong> папку <strong>styles</strong> в
            <strong>/wp-content/plugins/wpbb3/forum</strong>
        </p>

        <h2>2. Настройка форума phpbb3</h2>

        <h3>2.1 Установка и настройка форума phpbb3</h3>

        <p>2.1.1 Заходим по ссылке <strong>http://%domenname%/wp-content/plugins/wpbb3/forum/</strong>, авторизируемся, переходим
            в панель администрирования и настраиваем форум:</p>
        <p>2.1.1.1 На вкладке "ОБЩИЕ", меню Быстрый доступ -> Поисковые боты удаляем всех ботов;</p>
        <p>2.1.1.2 На вкладке "ОБЩИЕ", меню Конфигурация сервера -> Настройки cookies запоминаем имя куки;</p>
        <p>2.1.1.3 На вкладке "ОБЩИЕ", меню Конфигурация сервера -> Безопасность  все проверки ставим в "нет";</p>
        <p>2.1.1.4 На вкладке "ОБЩИЕ", меню Конфигурация -> Регистрация пользоваталей отключаем регистрацию;</p>
        <p>2.1.1.5 На вкладке "СТИЛИ", меню Управление стилями -> Стили устанавливаем и делаем по умолчанию стиль <strong>wordpress</strong>.</p>
        <p>Жмем в правом верхнем углу "Список форумов" и убеждаемся, что стиль применился.</p>
		<p>2.1.1.6 Открываем файл <strong>/forum/includes/functions.php</strong>, ищем там функцию redirect и после параметров global вставлем код:</p>
		<p>
			<i>
				// wpbb3 code START
    if (		strstr($url, WPBB3_QUERY_STRING_PREFIX) ) return;
    // w		// wpbb3 code END
			</i>
		</p>

        <h3>2.2 Настройка базы форума phpbb3</h3>

        <p>2.2.1 Переходим в phpmyadmin или любой другой инструмент для работы с базой данных и выполняем запрос <strong>phpbb3_changes.sql</strong>
            (подразумевается, что таблицы форума имееют префикс phpbb_, в противном случае необходимо подкорректировать файл запроса) из папки
            <strong>/wp-content/plugins/wpbb3/sql</strong>.</p>
        <p>2.2.2 Открываем файл <strong>/forum/includes/constants.php</strong> и меняем значение константы <strong>ANONYMOUS</strong> с 1 на 0.</p>
        <p>2.2.3 После заходим снова на форум, авторизируемся, пробуем зайти в админский раздел (через /forum/adm/). Форум должен работать.</p>
        <p>2.2.4 Копируем файл все из <strong>/wp-content/plugins/wpbb3/phpbb3</strong> (за исключением папки <strong>styles</strong>) в
            <strong>/wp-content/plugins/wpbb3/forum</strong>.</p>
        <p>2.2.5 Ощищаем кэш форума (папка /forum/cache). Выполняем п. 2.2.3, на форум заходим с параметром <strong>?direct=true</strong></p>
        <p>Убеждаемся, что без ?direct=true форум не работает.</p>
        <p>На этом настройка форума заканчивается.</p>

        <h3>3. Установка настройка плагина wpbb3</h3>

        <p>3.1 Заходим в админку wordpress и устанавливаем плагин <strong>wpbb3</strong>.</p>
        <p>3.2 Открываем файл <strong>Wpbb3.class.php</strong> и изменяем значение констант в соответствии с запомненным
            в п.2.1.1.2 именем куки форума.</p>
        <p>3.3 Создаем в админке вордппресса новую страницу с адресом <strong>/forum/</strong>. Если вы решите использовать
        другой адрес страницы для форума, то необходимо будет подправить <strong>PHPBB3_PATH_PREFIX</strong> в /forum/includes/hooks/hook_phpbb3_wordpress.php
        и <strong>FORUM_PHPBB3_PATH</strong> в wpbb3.php</p>
        <p>Запрещаем комментарии к этой странице.</p>
        <p>Внимание! Настройка постоянных ссылок (ЧПУ) должна отличаться от дефолтной в вашем блоге.</p>
        <p>3.4 Переходим в phpmyadmin или любой другой инструмент для работы с базой данных и выполняем следующее:</p>
        <p>3.4.1 Необходимо перенести админа блога на форум. Т.е. это будет тот человек, который сможет
            заходить на форум по прямой ссылке и в тоже время являться админом блога. Для этого нужно знать его
            логин. Пусть в нашем случае он будет - <strong>admin</strong>. </p>
        <p>Для этого выполняем запрос <strong>phpbb3_admin.sql</strong> (подразумевается, что таблицы форума
            имееют префикс phpbb_, a блога wp_, в противном случае необходимо подкорректировать файл запроса phpbb3_admin.sql).</p>
        <p>3.4.2 Выполняем запрос <strong>phpbb3_users.sql</strong>, который перенесет остальных пользователей блога,
            перенесет администраторов и модераторов блога в форум, добавит им необходимые права, обновит статистику форума
            по количеству зарегистрированных пользователей.
        <p>Будьте внимательны! Подразумевается, что таблицы форума имееют префикс phpbb_, имя пользователя админа блога - admin,
            имя админа форума - admin (см. п. 1.4), в противном случае необходимо подкорректировать файл запроса</p>
        <p>3.5 Копируем файл .htaccess из папки с плагином в корень блога. Не забудьте забэкапить исходный.</p>

        <h2>4. Проверка правильности установки плагина wpbb3</h2>

        <p>4.1 Блог и форум должны работать (общая авторизация, регистрация).</p>
        <p>4.2 В таблице <strong>phpbb_sessions</strong> для одного юзера должна быть <strong>одна</strong> запись.</p>

        <p>Всё, можно приступать к работе :)</p>

		 <h1>Примечания</h1>

		 <p>1. Для сервера ngnix, в случае появления ошибки <strong>411 Length Required</strong> раскомментируйте строчку
		 //curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Length: 0')); в Wpbb3.class.php.</p>
		 <p>2. В случае если вы по какми-то причинам увидите сообщение "На этом сайте форумов нет", то почистите куки.</p>

    </div>
</body>
</html>